# IPC Service Definitions
# This file defines services, methods, and error codes for code generation

config:
  method_id_base: 0x1000      # Auto-increment method IDs from here (must be multiple of 256!)
  error_code_base: 100         # Auto-increment service error codes from here

int_aliases:
  FileHandleId:
    signed: false

services:
  - name: Fibonacci
    methods:
      - name: calc_fib
        args:
          - name: n
        returns:
          - name: result
        errors: [INVALID_INPUT]

      - name: calc_pair
        args:
          - name: n
          - name: m
        returns:
          - name: fib_n
          - name: fib_m
        errors: [INVALID_INPUT]

      - name: get_cache_size
        args: []
        returns:
          - name: size
            signed: false
        errors: []

  - name: Graphics
    methods:
      - name: get_framebuffer
        args: []
        returns:
          - name: fb_ptr
            signed: false
          - name: width
            signed: false
          - name: height
            signed: false
        errors: [NOT_INITIALIZED]

      - name: flush
        args: []
        returns: []
        errors: [NOT_INITIALIZED]

  - name: Filesystem
    methods:
      # File handle operations
      - name: open
        args:
          - name: path
            type: string
          - name: flags
            type: uint
        returns:
          - name: handle
            type: FileHandleId
        errors: [FILE_NOT_FOUND, PATH_TOO_LONG, TOO_MANY_OPEN_FILES]

      - name: read
        args:
          - name: handle
            type: FileHandleId
          - name: offset
            type: uint
          - name: length
            type: uint
        returns:
          - name: bytes_read
            type: uint
        returns_comm_data: true
        errors: [INVALID_HANDLE, IO_ERROR]

      - name: write
        args:
          - name: handle
            type: FileHandleId
          - name: offset
            type: uint
          - name: data
            type: buffer
        returns:
          - name: bytes_written
            type: uint
        errors: [INVALID_HANDLE, IO_ERROR]

      - name: close
        args:
          - name: handle
            type: FileHandleId
        returns: []
        errors: [INVALID_HANDLE]

      # File creation
      - name: create_file
        args:
          - name: path
            type: string
        returns: []
        errors: [ALREADY_EXISTS, PARENT_NOT_FOUND, PATH_TOO_LONG]

      # Directory operations
      - name: create_dir
        args:
          - name: path
            type: string
        returns: []
        errors: [ALREADY_EXISTS, PARENT_NOT_FOUND, PATH_TOO_LONG]

      - name: delete_file
        args:
          - name: path
            type: string
        returns: []
        errors: [FILE_NOT_FOUND]

      - name: delete_dir
        args:
          - name: path
            type: string
        returns: []
        errors: [DIR_NOT_FOUND, NOT_EMPTY]

    # Service-level errors
    errors: [UNIMPLEMENTED]
